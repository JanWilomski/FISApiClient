<Window x:Class="FISApiClient.Views.OrderBookWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:FISApiClient.Converters"
        mc:Ignorable="d"
        Title="Order Book - FIS API Client"
        Height="700" Width="1400"
        WindowStartupLocation="CenterScreen"
        Background="#F5F5F5">

    <Window.Resources>
        <!-- Converters -->
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        
        <!-- Local converters -->
        <local:SideConverter x:Key="SideConverter"/>
        <local:ModalityConverter x:Key="ModalityConverter"/>
        <local:ValidityConverter x:Key="ValidityConverter"/>

        
        <!-- Style dla nagłówków DataGrid -->
        <Style x:Key="DataGridHeaderStyle" TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="#2C3E50"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="BorderThickness" Value="0,0,1,0"/>
            <Setter Property="BorderBrush" Value="#34495E"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
        </Style>

        <!-- Style dla wierszy DataGrid -->
        <Style x:Key="DataGridRowStyle" TargetType="DataGridRow">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="BorderBrush" Value="#ECEFF1"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E3F2FD"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#BBDEFB"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Style dla komórek DataGrid -->
        <Style x:Key="DataGridCellStyle" TargetType="DataGridCell">
            <Setter Property="Padding" Value="8,5"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
        </Style>

        <!-- Style dla Side -->
        <Style x:Key="SideCellStyle" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="Bold"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding Side}" Value="Buy">
                    <Setter Property="Foreground" Value="#27AE60"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Side}" Value="Sell">
                    <Setter Property="Foreground" Value="#E74C3C"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- Style dla Status -->
        <Style x:Key="StatusCellStyle" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="TextAlignment" Value="Center"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding Status}" Value="New">
                    <Setter Property="Text" Value="NEW"/>
                    <Setter Property="Foreground" Value="#3498DB"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="PartiallyFilled">
                    <Setter Property="Text" Value="PARTIAL"/>
                    <Setter Property="Foreground" Value="#F39C12"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Filled">
                    <Setter Property="Text" Value="FILLED"/>
                    <Setter Property="Foreground" Value="#27AE60"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Cancelled">
                    <Setter Property="Text" Value="CANCELLED"/>
                    <Setter Property="Foreground" Value="#95A5A6"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Rejected">
                    <Setter Property="Text" Value="REJECTED"/>
                    <Setter Property="Foreground" Value="#E74C3C"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="CenterAlignedTextBlockStyle" TargetType="TextBlock">
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <Style x:Key="RightAlignedTextBlockStyle" TargetType="TextBlock">
            <Setter Property="HorizontalAlignment" Value="Right"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,0,10,0"/>
            <Setter Property="FontFamily" Value="Consolas"/>
        </Style>

        <!-- Style dla przycisków -->
        <Style x:Key="ModernButtonStyle" TargetType="Button">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Opacity" Value="0.9"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Opacity" Value="0.7"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header Panel -->
        <Border Grid.Row="0" Background="#2C3E50" CornerRadius="5" Padding="15" Margin="0,0,0,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="📊 ORDER BOOK" 
                               FontSize="20" 
                               FontWeight="Bold" 
                               Foreground="White"
                               VerticalAlignment="Center"/>
                    
                    <Border Background="#27AE60" 
                            CornerRadius="3" 
                            Padding="8,4" 
                            Margin="15,0,0,0"
                            Visibility="{Binding IsRealTimeActive, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <TextBlock Text="● REAL-TIME" 
                                   Foreground="White" 
                                   FontSize="11" 
                                   FontWeight="Bold"/>
                    </Border>
                </StackPanel>

                <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="🔄 Odśwież" 
                            Command="{Binding RefreshCommand}"
                            Style="{StaticResource ModernButtonStyle}"
                            Background="#3498DB"
                            Margin="0,0,10,0"/>
                    
                    <Button Content="🗑️ Wyczyść" 
                            Command="{Binding ClearAllCommand}"
                            Style="{StaticResource ModernButtonStyle}"
                            Background="#95A5A6"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- DataGrid -->
        <Border Grid.Row="1" 
                Background="White" 
                BorderBrush="#BDC3C7" 
                BorderThickness="1" 
                CornerRadius="5"
                Margin="0,0,0,10">
            <DataGrid x:Name="OrdersDataGrid"
                      ItemsSource="{Binding Orders}"
                      SelectedItem="{Binding SelectedOrder}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      SelectionMode="Single"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      CanUserReorderColumns="True"
                      CanUserSortColumns="True"
                      GridLinesVisibility="None"
                      HeadersVisibility="Column"
                      ColumnHeaderStyle="{StaticResource DataGridHeaderStyle}"
                      RowStyle="{StaticResource DataGridRowStyle}"
                      CellStyle="{StaticResource DataGridCellStyle}"
                      AlternatingRowBackground="#FAFAFA"
                      RowHeight="35">

                <!-- CONTEXT MENU -->
                <DataGrid.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="📝 Modyfikuj zlecenie" 
                                  Command="{Binding ModifyOrderCommand}">
                            <MenuItem.Icon>
                                <TextBlock Text="📝" FontSize="14"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        
                        <MenuItem Header="🗑️ Anuluj zlecenie" 
                                  Command="{Binding CancelOrderCommand}">
                            <MenuItem.Icon>
                                <TextBlock Text="🗑️" FontSize="14"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        
                        <Separator/>
                        
                        <MenuItem Header="ℹ️ Pokaż Exchange Number" IsEnabled="False">
                            <MenuItem.Icon>
                                <TextBlock Text="ℹ️" FontSize="14"/>
                            </MenuItem.Icon>
                        </MenuItem>
                    </ContextMenu>
                </DataGrid.ContextMenu>

                <DataGrid.Columns>
                    <!-- Order ID -->
                    <DataGridTextColumn Header="Order ID" 
                                        Binding="{Binding OrderId}" 
                                        Width="120"
                                        ElementStyle="{StaticResource CenterAlignedTextBlockStyle}"/>

                    <!-- Exchange Number - WAŻNE! -->
                    <DataGridTextColumn Header="Exchange #" 
                                        Binding="{Binding ExchangeNumber}" 
                                        Width="100"
                                        ElementStyle="{StaticResource CenterAlignedTextBlockStyle}"/>

                    <!-- SLE Reference -->
                    <DataGridTextColumn Header="SLE Ref" 
                                        Binding="{Binding SleReference}" 
                                        Width="100"
                                        ElementStyle="{StaticResource CenterAlignedTextBlockStyle}"/>

                    <!-- Instrument -->
                    <DataGridTextColumn Header="Instrument" 
                                        Binding="{Binding Instrument}" 
                                        Width="120"
                                        ElementStyle="{StaticResource CenterAlignedTextBlockStyle}"/>

                    <!-- Side -->
                    <DataGridTemplateColumn Header="Side" Width="80">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Side, Converter={StaticResource SideConverter}}" 
                                           Style="{StaticResource SideCellStyle}"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Quantity -->
                    <DataGridTextColumn Header="Quantity" 
                                        Binding="{Binding Quantity, StringFormat=N0}" 
                                        Width="100"
                                        ElementStyle="{StaticResource RightAlignedTextBlockStyle}"/>

                    <!-- Executed Qty -->
                    <DataGridTextColumn Header="Executed" 
                                        Binding="{Binding ExecutedQuantity, StringFormat=N0}" 
                                        Width="100"
                                        ElementStyle="{StaticResource RightAlignedTextBlockStyle}"/>

                    <!-- Remaining Qty -->
                    <DataGridTextColumn Header="Remaining" 
                                        Binding="{Binding RemainingQuantity, StringFormat=N0}" 
                                        Width="100"
                                        ElementStyle="{StaticResource RightAlignedTextBlockStyle}"/>

                    <!-- Price -->
                    <DataGridTextColumn Header="Price" 
                                        Binding="{Binding Price, StringFormat=N2}" 
                                        Width="100"
                                        ElementStyle="{StaticResource RightAlignedTextBlockStyle}"/>

                    <!-- Modality -->
                    <DataGridTextColumn Header="Type" 
                                        Binding="{Binding Modality, Converter={StaticResource ModalityConverter}}" 
                                        Width="80"
                                        ElementStyle="{StaticResource CenterAlignedTextBlockStyle}"/>

                    <!-- Validity -->
                    <DataGridTextColumn Header="Validity" 
                                        Binding="{Binding Validity, Converter={StaticResource ValidityConverter}}" 
                                        Width="80"
                                        ElementStyle="{StaticResource CenterAlignedTextBlockStyle}"/>

                    <!-- Status -->
                    <DataGridTemplateColumn Header="Status" Width="120">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Style="{StaticResource StatusCellStyle}"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Order Time -->
                    <DataGridTextColumn Header="Order Time" 
                                        Binding="{Binding OrderTime, StringFormat='HH:mm:ss'}" 
                                        Width="90"
                                        ElementStyle="{StaticResource CenterAlignedTextBlockStyle}"/>

                    <!-- Last Update -->
                    <DataGridTextColumn Header="Last Update" 
                                        Binding="{Binding LastUpdateTime, StringFormat='HH:mm:ss'}" 
                                        Width="90"
                                        ElementStyle="{StaticResource CenterAlignedTextBlockStyle}"/>

                    <!-- Client Reference -->
                    <DataGridTextColumn Header="Client Ref" 
                                        Binding="{Binding ClientReference}" 
                                        Width="120"
                                        ElementStyle="{StaticResource CenterAlignedTextBlockStyle}"/>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- Status Bar -->
        <Border Grid.Row="2" 
                Background="#ECF0F1" 
                BorderBrush="#BDC3C7" 
                BorderThickness="1" 
                CornerRadius="5" 
                Padding="15,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Loading Indicator -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="⟳" 
                               FontSize="16" 
                               Foreground="#3498DB"
                               Margin="0,0,8,0"
                               Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <TextBlock.RenderTransform>
                            <RotateTransform x:Name="LoadingRotation" Angle="0" CenterX="8" CenterY="8"/>
                        </TextBlock.RenderTransform>
                        <TextBlock.Triggers>
                            <EventTrigger RoutedEvent="TextBlock.Loaded">
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="LoadingRotation"
                                                         Storyboard.TargetProperty="Angle"
                                                         From="0" To="360" 
                                                         Duration="0:0:1" 
                                                         RepeatBehavior="Forever"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                        </TextBlock.Triggers>
                    </TextBlock>
                    
                    <TextBlock Text="{Binding StatusMessage}" 
                               FontSize="13" 
                               Foreground="#34495E"
                               VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Order Count -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right">
                    <TextBlock Text="📋 Orders: " 
                               FontSize="13" 
                               FontWeight="SemiBold" 
                               Foreground="#7F8C8D"
                               VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding Orders.Count}" 
                               FontSize="13" 
                               FontWeight="Bold" 
                               Foreground="#2C3E50"
                               Margin="5,0,15,0"
                               VerticalAlignment="Center"/>
                    
                    <TextBlock Text="🔄 Updates: " 
                               FontSize="13" 
                               FontWeight="SemiBold" 
                               Foreground="#7F8C8D"
                               VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding UpdateCount}" 
                               FontSize="13" 
                               FontWeight="Bold" 
                               Foreground="#27AE60"
                               VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>